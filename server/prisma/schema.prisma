generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id                 String        @id @default(cuid())
  phoneNumber        String        @unique
  name               String
  ageRange           String
  approximateLocation String
  preferredLanguage  String
  accessibilityNeeds String?
  defaultPrivacySafe Boolean       @default(true)
  preferredCommMode  String        @default("text")
  emergencyContact   String?
  photoUrl           String?
  caregiver          Caregiver?    @relation(fields: [caregiverId], references: [id])
  caregiverId        String?
  profile            Profile?
  matchesInitiated   Match[]       @relation("InitiatorMatches")
  matchesReceived    Match[]       @relation("ReceiverMatches")
  messagesSent       Message[]     @relation("MessagesSent")
  messagesReceived   Message[]     @relation("MessagesReceived")
  orders             Order[]
  paymentMethods     PaymentMethod[]
  reportsFiled       Report[]      @relation("ReportsFiled")
  reportsAgainst     Report[]      @relation("ReportsAgainst")
  role               Role          @default(USER)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
}

model Caregiver {
  id        String  @id @default(cuid())
  name      String
  phone     String
  users     User[]
  createdAt DateTime @default(now())
}

model Profile {
  id                 String   @id @default(cuid())
  user               User     @relation(fields: [userId], references: [id])
  userId             String   @unique
  activityInterests  String   // comma separated from predefined list
  physicalConstraints String?
  availability       String?  // serialized time ranges
}

model Activity {
  id          String   @id @default(cuid())
  name        String
  description String?
  category    String
  isActive    Boolean  @default(true)
  matches     Match[]
}

model Match {
  id            String   @id @default(cuid())
  initiator     User     @relation("InitiatorMatches", fields: [initiatorId], references: [id])
  initiatorId   String
  receiver      User     @relation("ReceiverMatches", fields: [receiverId], references: [id])
  receiverId    String
  activity      Activity @relation(fields: [activityId], references: [id])
  activityId    String
  status        MatchStatus @default(PENDING)
  approximateDistanceKm Float?
  scheduledFor  DateTime?
  createdAt     DateTime @default(now())
  messages      Message[]
}

model Message {
  id          String   @id @default(cuid())
  match       Match    @relation(fields: [matchId], references: [id])
  matchId     String
  sender      User     @relation("MessagesSent", fields: [senderId], references: [id])
  senderId    String
  recipient   User     @relation("MessagesReceived", fields: [recipientId], references: [id])
  recipientId String
  content     String?
  voiceUrl    String?
  read        Boolean  @default(false)
  createdAt   DateTime @default(now())
}

model Order {
  id          String     @id @default(cuid())
  user        User       @relation(fields: [userId], references: [id])
  userId      String
  category    OrderCategory
  items       String     // serialized list of items
  status      OrderStatus @default(PENDING)
  totalAmount Float?
  createdAt   DateTime   @default(now())
}

model PaymentMethod {
  id          String   @id @default(cuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  provider    String
  tokenLast4  String
  isDefault   Boolean  @default(true)
  createdAt   DateTime @default(now())
}

model Report {
  id            String   @id @default(cuid())
  reporter      User     @relation("ReportsFiled", fields: [reporterId], references: [id])
  reporterId    String
  reportedUser  User     @relation("ReportsAgainst", fields: [reportedUserId], references: [id])
  reportedUserId String
  reason        String
  status        ReportStatus @default(OPEN)
  createdAt     DateTime @default(now())
}

enum Role {
  USER
  ADMIN
}

enum MatchStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum OrderCategory {
  GROCERIES
  MEDICINES
  MEALS
}

enum OrderStatus {
  PENDING
  CONFIRMED
  DISPATCHED
  COMPLETED
  CANCELLED
}

enum ReportStatus {
  OPEN
  IN_REVIEW
  RESOLVED
}


